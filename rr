# keywin‚Äëpro‚Äëultimate.ps1 ‚Äî Ativador PRO / Ultimate
# Baseado na vers√£o MAS v3.4 (HWID, KMS38, Online KMS, Ohook)
[Console]::Title = "KEYWIN PRO ULTIMATE"

function Show-Text { param($t,$c='White'); Write-Host $t -ForegroundColor $c }
function Separator { Show-Text ('='*60) Yellow }
function Pause { Read-Host "`n‚è∏ Pressione ENTER pra continuar..." }

function Check-Environment {
    if ($PSVersionTable.PSVersion.Major -lt 5) { Show-Text "‚ùå PS vers√£o < 5.0" Red; Pause; exit }
    try {
        $tmp = "$env:TEMP\kw_test.tmp"
        New-Item $tmp -ItemType File -Force | Out-Null
        Remove-Item $tmp -Force
    } catch {
        Show-Text "‚ùå Sem permiss√£o de escrita. Execute como Admin." Red
        Pause; exit
    }
}

function Install-MAS {
    Show-Text "`nüîÑ Baixando MAS (v3.4)..." Cyan
    iex (irm 'https://get.activated.win')
}

function Menu-Ultimate {
    Check-Environment
    do {
        Clear-Host; Separator
        Show-Text "     üîê KEYWIN PURUS  - Activation Suite     " Magenta
        Separator
        Show-Text "[1] Ativar Windows (Online KMS)" 
        Show-Text "[2] Ativar Windows (KMS38 - at√© 2038)" 
        Show-Text "[3] Ativar Windows (HWID - permanente)" 
        Show-Text "[4] Ativar Office (Ohook - permanente)" 
        Show-Text "[5] Ver status do Windows"
        Show-Text "[6] Ver status do Office"
        Show-Text "[7] Alterar servidor KMS"
        Show-Text "[8] Instalar chave VL manual"
        Show-Text "[0] Sair"
        Separator
        $op = Read-Host "`nEscolha uma op√ß√£o"
        switch ($op) {
            '1' { Install-MAS }  # MAS oferece menu interativo
            '2' { Install-MAS }
            '3' { Install-MAS }
            '4' { Install-MAS }
            '5' { slmgr /xpr; Pause }
            '6' { Show-Text "`nüìã Status Office:" Cyan; VerifOfficeStatus; Pause }
            '7' { $srv = Read-Host "Digite o novo servidor KMS"; slmgr /skms $srv; Show-Text "‚úÖ Servidor KMS atualizado: $srv" Green; Pause }
            '8' { $k = Read-Host "Digite nova chave VL"; slmgr /ipk $k; Show-Text "‚úÖ Chave instalada." Green; Pause }
            '0' { break }
            default { Show-Text "‚ùå Op√ß√£o inv√°lida" Red; Pause }
        }
    } while ($true)
}

function VerifOfficeStatus {
    $paths = @(
        "C:\Program Files\Microsoft Office\Office16",
        "C:\Program Files (x86)\Microsoft Office\Office16"
    )
    foreach ($p in $paths) {
        if (Test-Path (Join-Path $p 'ospp.vbs')) {
            cd $p
            cscript ospp.vbs /dstatus
            return
        }
    }
    Show-Text "‚ùå Office n√£o localizado." Red
}

Menu-Ultimate
