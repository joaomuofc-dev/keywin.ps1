# KEYWIN.ps1 - Ativador profissional Windows/Office
# Feito por Jo√£o Victor com base em pr√°ticas modernas (MAS, HWID, KMS)

[Console]::Title = "KEYWIN - Ativador PRO by Jo√£o Victor"

function Show-Text { param($txt, $color="White"); Write-Host $txt -ForegroundColor $color }
function Separator { Show-Text ("="*50) Yellow }

function Pause { Write-Host ""; Read-Host "‚è∏ Pressione ENTER para continuar..." }

function Check-Environment {
    try {
        if ($PSVersionTable.PSVersion.Major -lt 5) {
            Show-Text "‚ùå PowerShell muito antigo. Requer vers√£o 5 ou superior." Red
            Pause; exit
        }
        $tempFile = "$env:TEMP\keywin_test.tmp"
        New-Item $tempFile -ItemType File -Force | Out-Null
        Remove-Item $tempFile -Force
    } catch {
        Show-Text "‚ùå Erro ao acessar arquivos tempor√°rios. Execute como administrador." Red
        Pause; exit
    }
}

function Ativar-Windows {
    try {
        Show-Text "`nüîß Iniciando ativa√ß√£o do Windows..." Cyan
        $chave = "W269N-WFGWX-YVC9B-4J6C9-T83GX"
        slmgr /ipk $chave
        slmgr /skms kms.luoda.cn
        slmgr /ato
        Show-Text "`n‚úÖ Windows ativado com sucesso!" Green
    } catch {
        Show-Text "‚ùå Falha ao ativar o Windows: $_" Red
    }
    Pause
}

function Ativar-Office {
    Show-Text "`nüîç Procurando instala√ß√£o do Office..." Cyan
    $pastas = @(
        "C:\Program Files\Microsoft Office\Office16",
        "C:\Program Files (x86)\Microsoft Office\Office16",
        "C:\Program Files\Microsoft Office\Office15",
        "C:\Program Files (x86)\Microsoft Office\Office15"
    )
    $encontrado = $false
    foreach ($p in $pastas) {
        $ospp = Join-Path $p "ospp.vbs"
        if (Test-Path $ospp) {
            cd $p
            Show-Text "‚úî Office encontrado em: $p" Yellow
            cscript ospp.vbs /sethst:kms.luoda.cn
            cscript ospp.vbs /act
            Show-Text "`n‚úÖ Office ativado com sucesso!" Green
            $encontrado = $true
            break
        }
    }
    if (-not $encontrado) {
        Show-Text "‚ùå Office n√£o encontrado em diret√≥rios padr√£o." Red
    }
    Pause
}

function Status-Windows {
    Show-Text "`nüìã Status do Windows:" Cyan
    slmgr /xpr
    Pause
}

function Status-Office {
    $pastas = @(
        "C:\Program Files\Microsoft Office\Office16",
        "C:\Program Files (x86)\Microsoft Office\Office16"
    )
    foreach ($p in $pastas) {
        if (Test-Path (Join-Path $p "ospp.vbs")) {
            cd $p
            Show-Text "`nüìã Status do Office em: $p" Yellow
            cscript ospp.vbs /dstatus
            Pause
            return
        }
    }
    Show-Text "‚ùå Office n√£o localizado para exibir status." Red
    Pause
}

function Alterar-KMS {
    $novo = Read-Host "`nüåê Digite o novo endere√ßo KMS"
    slmgr /skms $novo
    Show-Text "‚úî Novo servidor definido: $novo" Green
    Pause
}

function Instalar-Chave {
    $chave = Read-Host "`nüîë Digite a chave do produto (VL)"
    slmgr /ipk $chave
    Show-Text "‚úî Chave instalada com sucesso!" Green
    Pause
}

function Redefinir-Ativacao {
    Show-Text "`n‚ôª Redefinindo ativa√ß√£o do Windows (Rearm)..." Cyan
    slmgr /rearm
    Show-Text "‚úî Estado de ativa√ß√£o redefinido. Reinicie o sistema!" Yellow
    Pause
}

function Menu-KeyWin {
    Check-Environment
    do {
        Clear-Host
        Separator
        Show-Text "      üîê KEYWIN PRO - Ativador Completo        " Magenta
        Separator
        Show-Text "[1] ü™ü Ativar Windows"
        Show-Text "[2] üß© Ativar Office"
        Show-Text "[3] ‚úÖ Ver status do Windows"
        Show-Text "[4] üìã Ver status do Office"
        Show-Text "[5] üåê Alterar servidor KMS"
        Show-Text "[6] üß∑ Instalar chave do produto"
        Show-Text "[7] ‚ôª Redefinir ativa√ß√£o (Rearm)"
        Show-Text "[0] ‚ùå Sair"
        Separator
        $op = Read-Host "`nEscolha uma op√ß√£o"
        switch ($op) {
            "1" { Ativar-Windows }
            "2" { Ativar-Office }
            "3" { Status-Windows }
            "4" { Status-Office }
            "5" { Alterar-KMS }
            "6" { Instalar-Chave }
            "7" { Redefinir-Ativacao }
            "0" { break }
            default {
                Show-Text "‚ùå Op√ß√£o inv√°lida. Tente novamente." Red
                Pause
            }
        }
    } while ($true)
}

Menu-KeyWin
